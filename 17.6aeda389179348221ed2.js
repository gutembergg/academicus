(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"7Z3z":function(o,t,e){"use strict";e.r(t),e.d(t,"UserProfileModule",function(){return F});var i=e("ofXK"),n=e("tyNb"),r=e("fXoL"),s=e("mrSG"),b=e("2Vo4"),c=e("lJxs"),l=e("I/3d"),u=e("UbJi");let a=(()=>{class o{constructor(o,t){this._firestore=o,this._angularAuth=t,this._userBooks$=new b.a([]),this.userBooks$=this._userBooks$.asObservable(),this._bookDetail$=new b.a(null),this.bookDetail$=this._bookDetail$.asObservable()}getUserBooks(){return Object(s.b)(this,void 0,void 0,function*(){const o=yield this._angularAuth.currentUser.then(o=>o.uid);this._firestore.collection("books",t=>t.where("userId","==",`${o}`)).stateChanges(["added","modified","removed"]).pipe(Object(c.a)(o=>o.map(o=>{const t=o.payload.doc.data();return Object.assign({id:o.payload.doc.id},t)}))).subscribe(o=>{const t=[...this._userBooks$.value.filter(t=>!o.find(o=>o.id===t.id)),...o];this._userBooks$.next(t)})})}getUserBookById(o){this._firestore.collection("books").doc(o).valueChanges({idField:"_id"}).subscribe(o=>console.log("===>",o))}}return o.\u0275fac=function(t){return new(t||o)(r.Sb(l.a),r.Sb(u.a))},o.\u0275prov=r.Hb({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var d=e("TEn/");let h=(()=>{class o{constructor(o,t,e){this._userBookService=o,this._router=t,this._route=e}ngOnInit(){this._route.params.subscribe(o=>{this._userBookService.getUserBookById(o.id),this._userBookService.bookDetail$.subscribe(o=>console.log("res",o))})}}return o.\u0275fac=function(t){return new(t||o)(r.Lb(a),r.Lb(n.e),r.Lb(n.a))},o.\u0275cmp=r.Fb({type:o,selectors:[["app-book-edit-remove"]],decls:17,vars:1,consts:[["slot","start"],[1,"ion-justify-content-center"]],template:function(o,t){1&o&&(r.Ob(0,"ion-header"),r.Ob(1,"ion-toolbar"),r.Ob(2,"ion-buttons",0),r.Mb(3,"ion-back-button"),r.Nb(),r.Ob(4,"ion-title"),r.nc(5,"Titre"),r.Nb(),r.Nb(),r.Nb(),r.Ob(6,"ion-content"),r.Ob(7,"ion-card"),r.Ob(8,"ion-card-header"),r.Ob(9,"ion-grid"),r.Ob(10,"ion-row",1),r.Ob(11,"ion-card-title"),r.nc(12),r.Nb(),r.Nb(),r.Mb(13,"ion-row",1),r.Ob(14,"ion-row",1),r.Ob(15,"ion-text"),r.nc(16," \xc9diteur: "),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Nb()),2&o&&(r.Bb(12),r.pc(" ",null==t.selectedBook$?null:t.selectedBook$.title," "))},directives:[d.n,d.K,d.e,d.b,d.c,d.J,d.l,d.f,d.h,d.m,d.v,d.j,d.G],styles:[""]}),o})();var f=e("3Pt+"),m=e("SxV6"),O=e("AytR"),g=e("JIr8"),k=e("tk/3");const p=O.a.apiBooksUrl;let v=(()=>{class o{constructor(o){this._http=o}searchApiBook(o){return Object(s.b)(this,void 0,void 0,function*(){return yield this._http.get(`${p}${o}`).pipe(Object(g.a)(o=>Object(s.b)(this,void 0,void 0,function*(){return console.log("error: ",o)}))).toPromise()})}}return o.\u0275fac=function(t){return new(t||o)(r.Sb(k.a))},o.\u0275prov=r.Hb({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var N=e("qBIq"),B=e("gcOT"),_=e("Vaw3");let y=(()=>{class o{constructor(o,t){this._fireStorage=o,this._angularAuth=t,this._urlPhotoSubject$=new b.a(null),this.urlPhoto$=this._urlPhotoSubject$.asObservable()}takePhoto(){return Object(s.b)(this,void 0,void 0,function*(){const o=yield B.b.getPhoto({resultType:B.c.Uri,source:B.d.Camera,quality:100});return this.imageUrl=o.webPath,this.saveImage()})}saveImage(){return Object(s.b)(this,void 0,void 0,function*(){const o=yield this._angularAuth.currentUser.then(o=>o.uid),t=Date.now(),e=yield this.readAsBlob(this.imageUrl),i=this._fireStorage.ref(`${t}${o}`);yield i.put(e);const n=yield i.getDownloadURL().toPromise();return console.log("url: ",n),n})}readAsBlob(o){return Object(s.b)(this,void 0,void 0,function*(){const t=yield fetch(o);return yield t.blob()})}}return o.\u0275fac=function(t){return new(t||o)(r.Sb(_.a),r.Sb(u.a))},o.\u0275prov=r.Hb({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();const j=function(o){return["/pages/user-profile/user-book",o]};function S(o,t){if(1&o){const o=r.Pb();r.Ob(0,"ion-slide",4),r.Wb("click",function(){r.jc(o);const e=t.$implicit;return r.Yb().selectBook(e.id)}),r.Ob(1,"ion-grid",5),r.Ob(2,"ion-row",6),r.Mb(3,"img",7),r.Nb(),r.Ob(4,"ion-row",6),r.Ob(5,"p"),r.nc(6),r.Nb(),r.Nb(),r.Nb(),r.Nb()}if(2&o){const o=t.$implicit;r.dc("routerLink",r.gc(3,j,o.id)),r.Bb(3),r.dc("src",o.image,r.kc),r.Bb(3),r.oc(o.title.substr(0,25))}}let I=(()=>{class o{constructor(o,t){this._userBooksService=o,this._router=t,this.slideOpts={slidesPerView:3,coverflowEffect:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0}}}ngOnInit(){return Object(s.b)(this,void 0,void 0,function*(){yield this._userBooksService.getUserBooks(),this._userBooksService.userBooks$.subscribe(o=>this.userBooks$=o)})}selectBook(o){this._userBooksService.getUserBookById(o)}}return o.\u0275fac=function(t){return new(t||o)(r.Lb(a),r.Lb(n.e))},o.\u0275cmp=r.Fb({type:o,selectors:[["app-user-books"]],decls:7,vars:2,consts:[["color","primary"],[1,"block_list"],[3,"options"],["routerLinkActive","router-link-active",3,"routerLink","click",4,"ngFor","ngForOf"],["routerLinkActive","router-link-active",3,"routerLink","click"],["fixed",""],[1,"ion-justify-content-center"],["alt","test",1,"img_book",3,"src"]],template:function(o,t){1&o&&(r.Ob(0,"ion-content"),r.Ob(1,"ion-text",0),r.Ob(2,"h1"),r.nc(3,"Mes livres"),r.Nb(),r.Nb(),r.Ob(4,"div",1),r.Ob(5,"ion-slides",2),r.mc(6,S,7,5,"ion-slide",3),r.Nb(),r.Nb(),r.Nb()),2&o&&(r.Bb(5),r.dc("options",t.slideOpts),r.Bb(1),r.dc("ngForOf",t.userBooks$))},directives:[d.l,d.G,d.C,i.j,d.B,n.g,n.f,d.N,d.m,d.v],styles:["ion-content[_ngcontent-%COMP%]{height:100vh}.img_book[_ngcontent-%COMP%]{height:130px}.block_list[_ngcontent-%COMP%]{margin:30px 10px 10px}"]}),o})();const w=function(){return["/pages/book-detail"]};function L(o,t){if(1&o){const o=r.Pb();r.Ob(0,"ion-item",8),r.Wb("click",function(){r.jc(o);const e=t.$implicit;return r.Yb().seletedBook(e)}),r.Ob(1,"ion-thumbnail",9),r.Mb(2,"img",10),r.Nb(),r.Ob(3,"ion-label",11),r.Ob(4,"ion-text"),r.Ob(5,"h2"),r.Ob(6,"strong"),r.nc(7),r.Nb(),r.Nb(),r.Nb(),r.Ob(8,"ion-text"),r.Ob(9,"h5"),r.nc(10),r.Nb(),r.Nb(),r.Nb(),r.Nb()}if(2&o){const o=t.$implicit;r.Bb(2),r.dc("src",null!=o.volumeInfo.imageLinks&&o.volumeInfo.imageLinks.smallThumbnail?null==o.volumeInfo.imageLinks?null:o.volumeInfo.imageLinks.smallThumbnail:"../../../assets/book-cover-placeholder.jpg",r.kc),r.Bb(1),r.dc("routerLink",r.fc(4,w)),r.Bb(4),r.oc(o.volumeInfo.title),r.Bb(3),r.oc(o.volumeInfo.authors)}}function P(o,t){if(1&o&&(r.Ob(0,"ion-select-option",23),r.nc(1),r.Nb()),2&o){const o=t.$implicit;r.dc("value",o.name),r.Bb(1),r.pc(" ",o.name," ")}}function $(o,t){if(1&o){const o=r.Pb();r.Ob(0,"div"),r.Ob(1,"ion-grid",6),r.Ob(2,"ion-row"),r.Ob(3,"form",12),r.Wb("ngSubmit",function(){return r.jc(o),r.Yb().onSubmit()}),r.Ob(4,"ion-col",7),r.Ob(5,"ion-text",13),r.Ob(6,"h4"),r.nc(7,"Ajouter livre"),r.Nb(),r.Nb(),r.Nb(),r.Ob(8,"ion-col",7),r.Ob(9,"ion-item"),r.Ob(10,"ion-label",14),r.nc(11,"Titre"),r.Nb(),r.Mb(12,"ion-input",15),r.Nb(),r.Nb(),r.Ob(13,"ion-col",7),r.Ob(14,"ion-item"),r.Ob(15,"ion-label",14),r.nc(16,"Author"),r.Nb(),r.Mb(17,"ion-input",16),r.Nb(),r.Nb(),r.Ob(18,"ion-col",7),r.Ob(19,"ion-item"),r.Ob(20,"ion-label",14),r.nc(21,"Editeur"),r.Nb(),r.Mb(22,"ion-input",17),r.Nb(),r.Nb(),r.Ob(23,"ion-col",7),r.Ob(24,"ion-item"),r.Ob(25,"ion-button",18),r.Wb("click",function(){return r.jc(o),r.Yb().takePhoto()}),r.nc(26," Photo "),r.Nb(),r.Nb(),r.Nb(),r.Ob(27,"ion-col",7),r.Ob(28,"ion-item"),r.Ob(29,"ion-label",14),r.nc(30,"Offre"),r.Nb(),r.Mb(31,"ion-input",19),r.Nb(),r.Nb(),r.Ob(32,"ion-col",7),r.Ob(33,"ion-item"),r.Ob(34,"ion-label"),r.nc(35,"Categories"),r.Nb(),r.Ob(36,"ion-select",20),r.mc(37,P,2,2,"ion-select-option",21),r.Nb(),r.Nb(),r.Nb(),r.Ob(38,"ion-col",7),r.Ob(39,"ion-button",22),r.nc(40," Valider "),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Nb()}if(2&o){const o=r.Yb();r.Bb(3),r.dc("formGroup",o.form),r.Bb(34),r.dc("ngForOf",o.categoriesList)}}const x=[{path:"",component:(()=>{class o{constructor(o,t,e,i,n,r){this._apiService=o,this._router=t,this._bookService=e,this.cameraService=i,this._formBuilder=n,this._angularAuth=r,this.bookSelected={title:"",authors:"",image:"",publisher:""},this.toggleForm=!1}ngOnInit(){return Object(s.b)(this,void 0,void 0,function*(){this.form=this._formBuilder.group({userId:["",f.j.required],title:["",f.j.required],author:["",f.j.required],categoryId:["",f.j.required],image:["",f.j.required],publisher:["",f.j.required],offer:["",f.j.required]}),this.categoriesList=yield this._bookService.getCategories().pipe(Object(m.a)()).toPromise()})}getApibooks(o){return Object(s.b)(this,void 0,void 0,function*(){const t=yield this._apiService.searchApiBook(o);this.booksList=t.items})}seletedBook(o){var t;this.bookSelected=Object.assign(Object.assign({},this.bookSelected),{title:o.volumeInfo.title,authors:Array.isArray(o.volumeInfo.authors)?o.volumeInfo.authors[0]:o.volumeInfo.authors,image:null===(t=o.volumeInfo.imageLinks)||void 0===t?void 0:t.smallThumbnail,publisher:o.volumeInfo.publisher}),this._bookService.set(this.bookSelected),this._router.navigate(["/pages/book-detail"])}toggleBookForm(){this.toggleForm=!this.toggleForm}takePhoto(){return Object(s.b)(this,void 0,void 0,function*(){const o=yield this.cameraService.takePhoto();this.photoUrl=o})}onSubmit(){return Object(s.b)(this,void 0,void 0,function*(){const o=yield this._angularAuth.currentUser.then(o=>o.uid),t=Object.assign(Object.assign({},this.form.value),{userId:o,image:this.photoUrl});this._bookService.createBook(t),this.toggleForm=!1})}getEvent(o){this.booksList=[]}}return o.\u0275fac=function(t){return new(t||o)(r.Lb(v),r.Lb(n.e),r.Lb(N.a),r.Lb(y),r.Lb(f.a),r.Lb(u.a))},o.\u0275cmp=r.Fb({type:o,selectors:[["app-user-profile"]],decls:20,vars:2,consts:[["type","text",3,"ionClear"],["search",""],["color","primary","expand","block","fill","solid",3,"click"],[3,"click",4,"ngFor","ngForOf"],["color","primary","expand","block",3,"click"],[4,"ngIf"],["fixed",""],["size","12"],[3,"click"],["slot","start"],[3,"src"],[3,"routerLink"],[1,"formSubmit",3,"formGroup","ngSubmit"],["color","primary"],["position","stacked"],["formControlName","title"],["formControlName","author"],["formControlName","publisher"],["expand","block",3,"click"],["formControlName","offer"],["formControlName","categoryId","okText","Ok","cancelText","Cancel"],[3,"value",4,"ngFor","ngForOf"],["expand","block","type","submit",1,"btn"],[3,"value"]],template:function(o,t){if(1&o){const o=r.Pb();r.Ob(0,"ion-header"),r.Ob(1,"ion-toolbar"),r.Ob(2,"ion-title"),r.nc(3,"Profile"),r.Nb(),r.Nb(),r.Nb(),r.Ob(4,"ion-content"),r.Ob(5,"p"),r.nc(6,"Cherchez votre livre ou ajouter vous m\xeame"),r.Nb(),r.Ob(7,"ion-searchbar",0,1),r.Wb("ionClear",function(o){return t.getEvent(o)}),r.Nb(),r.Ob(9,"ion-button",2),r.Wb("click",function(){r.jc(o);const e=r.ic(8);return t.getApibooks(e.value)}),r.nc(10,"Valider"),r.Nb(),r.Ob(11,"ion-list"),r.mc(12,L,11,5,"ion-item",3),r.Nb(),r.Ob(13,"ion-button",4),r.Wb("click",function(){return t.toggleBookForm()}),r.nc(14,"Enregister moi m\xeame"),r.Nb(),r.mc(15,$,41,2,"div",5),r.Ob(16,"ion-grid",6),r.Ob(17,"ion-row"),r.Ob(18,"ion-col",7),r.Mb(19,"app-user-books"),r.Nb(),r.Nb(),r.Nb(),r.Nb()}2&o&&(r.Bb(12),r.dc("ngForOf",t.booksList),r.Bb(3),r.dc("ngIf",t.toggleForm))},directives:[d.n,d.K,d.J,d.l,d.w,d.P,d.d,d.t,i.j,i.k,d.m,d.v,d.k,I,d.r,d.I,d.s,n.f,d.N,d.G,f.k,f.h,f.c,d.q,f.g,f.b,d.z,d.O,d.A],styles:[".btn[_ngcontent-%COMP%]{height:40px;margin-top:15px}.btn[_ngcontent-%COMP%], .formSubmit[_ngcontent-%COMP%]{width:100%}"]}),o})()},{path:"user-book/:id",component:h}];let C=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=r.Jb({type:o}),o.\u0275inj=r.Ib({imports:[[n.h.forChild(x)],n.h]}),o})();var A=e("PCNd");let F=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=r.Jb({type:o}),o.\u0275inj=r.Ib({imports:[[i.c,C,d.L,A.a,f.i]]}),o})()}}]);